<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Cardano.Wallet.Primitive.CoinSelection.Random</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Cardano.Wallet.Primitive.CoinSelection.Random.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-wallet-core-2020.3.16: The Wallet Backend for a Cardano node.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>&#169; 2018-2020 IOHK</td></tr><tr><th>License</th><td>Apache-2.0</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Cardano.Wallet.Primitive.CoinSelection.Random</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module contains the implementation of random
 input selection algorithm</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:random">random</a> :: <span class="keyword">forall</span> m e. MonadRandom m =&gt; <a href="Cardano-Wallet-Primitive-CoinSelection.html#t:CoinSelectionOptions" title="Cardano.Wallet.Primitive.CoinSelection">CoinSelectionOptions</a> e -&gt; <a href="../base-4.12.0.0/Data-List-NonEmpty.html#t:NonEmpty" title="Data.List.NonEmpty">NonEmpty</a> <a href="Cardano-Wallet-Primitive-Types.html#t:TxOut" title="Cardano.Wallet.Primitive.Types">TxOut</a> -&gt; <a href="Cardano-Wallet-Primitive-Types.html#t:UTxO" title="Cardano.Wallet.Primitive.Types">UTxO</a> -&gt; <a href="../mtl-2.2.2/Control-Monad-Except.html#t:ExceptT" title="Control.Monad.Except">ExceptT</a> (<a href="Cardano-Wallet-Primitive-CoinSelection.html#t:ErrCoinSelection" title="Cardano.Wallet.Primitive.CoinSelection">ErrCoinSelection</a> e) m (<a href="Cardano-Wallet-Primitive-CoinSelection.html#t:CoinSelection" title="Cardano.Wallet.Primitive.CoinSelection">CoinSelection</a>, <a href="Cardano-Wallet-Primitive-Types.html#t:UTxO" title="Cardano.Wallet.Primitive.Types">UTxO</a>)</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:random" class="def">random</a> :: <span class="keyword">forall</span> m e. MonadRandom m =&gt; <a href="Cardano-Wallet-Primitive-CoinSelection.html#t:CoinSelectionOptions" title="Cardano.Wallet.Primitive.CoinSelection">CoinSelectionOptions</a> e -&gt; <a href="../base-4.12.0.0/Data-List-NonEmpty.html#t:NonEmpty" title="Data.List.NonEmpty">NonEmpty</a> <a href="Cardano-Wallet-Primitive-Types.html#t:TxOut" title="Cardano.Wallet.Primitive.Types">TxOut</a> -&gt; <a href="Cardano-Wallet-Primitive-Types.html#t:UTxO" title="Cardano.Wallet.Primitive.Types">UTxO</a> -&gt; <a href="../mtl-2.2.2/Control-Monad-Except.html#t:ExceptT" title="Control.Monad.Except">ExceptT</a> (<a href="Cardano-Wallet-Primitive-CoinSelection.html#t:ErrCoinSelection" title="Cardano.Wallet.Primitive.CoinSelection">ErrCoinSelection</a> e) m (<a href="Cardano-Wallet-Primitive-CoinSelection.html#t:CoinSelection" title="Cardano.Wallet.Primitive.CoinSelection">CoinSelection</a>, <a href="Cardano-Wallet-Primitive-Types.html#t:UTxO" title="Cardano.Wallet.Primitive.Types">UTxO</a>) <a href="src/Cardano.Wallet.Primitive.CoinSelection.Random.html#random" class="link">Source</a> <a href="#v:random" class="selflink">#</a></p><div class="doc"><p>Random-Improve Algorithm</p><ol><li>Randomly select outputs from the UTxO until the payment value is covered.
    (In the rare case that this fails because the maximum number of
    transaction inputs has been exceeded, fall back on the largest-first
    algorithm for this step.)</li><li>The algorithm first makes a random  selection for each output from the UTxO,
    processing the biggest output first and proceeding in a descending order.
    If the selection is not successful largest-first fallback kicks in.
    If the selection is successful for each output then the
    improvement is tried for each selection, once again starting from the selection
    made for the biggest output. The improvement is tried for the next biggest output's
    selection. An output is considered an improvement when:</li></ol><p>(a)  It doesn&#8217;t exceed a specified upper limit.
    (b)  Adding the new output gets us closer to the ideal change value.
    (c)  It doesn&#8217;t exceed a maximum number of transaction inputs.</p><p>This algorithm follows three principles:</p><pre>**Self organisation principle 1**
Random selection has a high probability of picking dust outputs precisely
when there is a lot of dust in the UTxO.
</pre><pre>**Self organisation principle 2**
If for each payment request for value <code>x</code> we create a change output roughly
of the same value <code>x</code>, then we will end up with a lot of change outputs in
our UTxO of size <code>x</code> precisely when we have a lot of payment requests of
size <code>x</code>
</pre><pre>**Self organisation principle 3**
Searching the UTxO for additional entries to improve our change output is
only useful if the UTxO contains entries that are sufficiently small enough.
But precisely when the UTxO contains many small entries, it is less likely
that a randomly chosen UTxO entry will push the total above the upper bound
we set.
</pre></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>